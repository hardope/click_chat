{% extends "layout1.html" %}

      <meta name="viewport" content="initial-scale=1, width=device-width">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
{% block body %}
<script>
     let react = ""
     function get_int(input){
         num = ""
        for (let i = 0; i < input.length; i++) {
            if (input[i]== "🖤"){
                break
            } else{
                num += input[i]
            }
        }
        return parseInt(num)
     }
     function like(input){
          let box = document.getElementById(input)

          if (box.getAttribute('value') == "true") {
               box.innerHTML = (get_int(box.textContent) - 1) + "🖤"
               box.setAttribute('value', "false")
               let url = window.location.origin
               let request = new XMLHttpRequest();
               let body = document.querySelector('#body');
               request.open("GET", url + "/unlike/" + input);
               request.send();

          } else {
               box.setAttribute('value', "true")
               box.innerHTML = (get_int(box.textContent) + 1) + "❤️"
               let url = window.location.origin
               let request = new XMLHttpRequest();
               let body = document.querySelector('#body');
               request.open("GET", url + "/like/" + input);
               request.send();

          }
     }
     document.addEventListener('DOMContentLoaded', function(){
         let months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
         function get_time(input) {
            var currentTime = new Date()
            var year = currentTime.getFullYear()
            let initial = input.split(" ")
            let time = initial[1]
            let date = initial[0]
            date = date.split("-")
            time = time.slice(0, -3);
            time = time.split(":")
            time[0] = parseInt(time[0])+1
            if (time[0] > 23){
                time[0]-=23;
            }
            date[1] = months[parseInt(date[1]) - 1]
            date.push(date.shift())
            date = date.toString()
            date = date.replace(year.toString(), "")
            date = date.replace(",", " ")
            time = time.toString()
            time = time.replace(",", ':')
            result = date + " " + time
            return (result)
        }
          let a = 1
          let url = window.location.origin
          let request = new XMLHttpRequest();
          let body = document.querySelector('#body');
          request.open("GET", url + "/posts/open");
          request.send();
          request.onload = () => {
               if (request.status === 200) {
                    let body = document.querySelector('#body');
                    for (let obj of JSON.parse(request.response)) {
                         var name_container = document.createElement('div')
                         name_container.setAttribute('class', 'name_container')
                         var name = document.createElement('a');
                         name.setAttribute('class', 'a')
                         name.textContent = obj[1];
                         name.setAttribute('href', "/profile/" + obj[1])
                         name_container.appendChild(name)
                         body.appendChild(name_container)
                         var time = document.createElement('p');
                         time.setAttribute('style', 'margin-top: -10px;  font-size: 15px !important;')
                         time.setAttribute('class', 'a')
                         time.textContent = get_time(obj[3]);
                         body.appendChild(time);
                         var tag = document.createElement('div');
                         tag.textContent = obj[2];
                         tag.setAttribute('class', 'div')
                         body.appendChild(tag);
                         if (obj[7] === "True"){
                              let link = document.createElement('a');
                              link.setAttribute("href", '/static/'+ obj[0] +'.jpg')
                              var pic = document.createElement('img');
                              pic.setAttribute('src', '/static/'+ obj[0] +'.jpg')
                              link.appendChild(pic)
                              body.appendChild(link)
                         }
                         var container = document.createElement('div');
                         container.setAttribute('class', 'container')
                         var react = document.createElement('p')
                         react.setAttribute('class', 'react')
                         react.setAttribute('value', obj[5])
                         react.setAttribute('id', obj[0])
                         react.setAttribute('style', 'inline')
                         react.setAttribute('onclick', 'like(' + obj[0] + ')')
                         react.textContent = obj[4];
                         container.appendChild(react)
                         var link = document.createElement('a')
                         link.setAttribute('href', '/comment/' + obj[0])
                         var comment = document.createElement('p')
                         comment.setAttribute('class', 'comment')
                         comment.setAttribute('style', 'inline')
                         comment.textContent = obj[6] + ' 💬';
                         link.appendChild(comment)
                         container.appendChild(link)
                         body.appendChild(container)

                         a+=1
                    }
               }
          }

     });
</script>
<style>
     .name_container{
          max-width: 750px;
          width: 100vw;
          border-top: solid;
          border-width: 1px;
     }
     img{
          margin-top: -10px;
          width: 100vw;
          height: auto;
          min-height: 50px;
          max-width: 750px;
     }
     .container{
          max-width: 750px;
          display: flex;
          border-top: solid;
          border-width: 1px;
     }
     html {
          scroll-behavior: smooth;
     }
     .a{
          margin-left: 55px;
     }
     .div{
          display: block;
          width: 100vw;
          height: auto;
          min-height: 50px;
          max-width: 750px;
          padding: 20px 20px 20px 20px;
          text-align: center;
          font-size: 20px;
          word-wrap: break-word;
     }
     .react{
          height: 50px;
          width: 50vw;
          align-self: center;
          max-width: 345px;
          text-align: center;
          display: block;
          border-right: solid;
          border-width: 1px;
          margin-left: 10px;
     }
     .comment{
          height: 50px;
          width: 50vw;
          align-self: center;
          max-width: 345px;
          text-align: center;
          display: block;
     }
 </style>
 <script>
      var a = 0;
  </script>
 <div style="margin-top: 35px; margin-bottom: 20px;">
     <form action="/posts/new">
          <button type="submit" style="border-radius: 10px; margin-left: 20%; height: 40px; border-color: rgb(224, 227, 229);">Create New Post</button>
     </form>
 </div>
<div id="body" style="font-size: 40px !important;">

</div>
{% endblock %}